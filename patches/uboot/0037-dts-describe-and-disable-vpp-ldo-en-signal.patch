From 70ac36397140c21b1038a84d52058918c206bf52 Mon Sep 17 00:00:00 2001
From: Josua Mayer <josua@solid-run.com>
Date: Mon, 9 Oct 2023 17:47:49 +0200
Subject: [PATCH] dts: describe (and disable) vpp-ldo-en signal

Signed-off-by: Josua Mayer <josua@solid-run.com>
---
 arch/arm/dts/am642-solidrun.dts    | 18 ++++++++++++++++++
 arch/arm/dts/am64x-solidrun-r5.dts | 26 ++++++++++++++++++++++++++
 2 files changed, 44 insertions(+)

diff --git a/arch/arm/dts/am642-solidrun.dts b/arch/arm/dts/am642-solidrun.dts
index 479c9b257f..d4a28f0d57 100644
--- a/arch/arm/dts/am642-solidrun.dts
+++ b/arch/arm/dts/am642-solidrun.dts
@@ -50,6 +50,18 @@
 			no-map;
 		};
 	};
+
+	/* only for programming efuses (VPP_1V8) */
+	regulator-vpp-1v8 {
+		compatible = "regulator-fixed";
+		regulator-name = "vpp-1v8";
+		regulator-min-microvolt = <1800000>;
+		regulator-max-microvolt = <1800000>;
+		pinctrl-names = "default";
+		pinctrl-0 = <&regulator_vpp_1v8_pins_default>;
+		gpio = <&main_gpio1 78 GPIO_ACTIVE_HIGH>;
+		enable-active-high;
+	};
 };
 
 &cpsw3g {
@@ -255,6 +267,12 @@
 		>;
 	};
 
+	regulator_vpp_1v8_pins_default: regulator-vpp-1v8-pins-default {
+		pinctrl-single,pins = <
+			AM64X_IOPAD(0x029c, PIN_OUTPUT, 7)	/* Pad MMC1_SDWP Mux GPIO1_78 */
+		>;
+	};
+
 	rgmii1_pins_default: rgmii1-pins-default {
 		pinctrl-single,pins = <
 			AM64X_IOPAD(0x01cc, PIN_INPUT, 4)	/* Pad PRG0_PRU1_GPO7 Mux RGMII1_RD0 */
diff --git a/arch/arm/dts/am64x-solidrun-r5.dts b/arch/arm/dts/am64x-solidrun-r5.dts
index 96797bf955..fa5d481d5f 100644
--- a/arch/arm/dts/am64x-solidrun-r5.dts
+++ b/arch/arm/dts/am64x-solidrun-r5.dts
@@ -72,6 +72,19 @@
 		regulator-always-on;
 		regulator-boot-on;
 	};
+
+	/* only for programming efuses (VPP_1V8) */
+	regulator-vpp-1v8 {
+		u-boot,dm-spl;
+		compatible = "regulator-fixed";
+		regulator-name = "vpp-1v8";
+		regulator-min-microvolt = <1800000>;
+		regulator-max-microvolt = <1800000>;
+		pinctrl-names = "default";
+		pinctrl-0 = <&regulator_vpp_1v8_pins_default>;
+		gpio = <&main_gpio1 78 GPIO_ACTIVE_HIGH>;
+		enable-active-high;
+	};
 };
 
 &cbass_main {
@@ -149,6 +162,11 @@
 	status = "okay";
 };
 
+&main_gpio1 {
+	u-boot,dm-spl;
+	status = "okay";
+};
+
 &main_pmx0 {
 	u-boot,dm-spl;
 
@@ -218,11 +236,19 @@
 	};
 
 	ospi0_flash0_pins_default: ospi0-flash0-pins-default {
+		u-boot,dm-spl;
 		pinctrl-single,pins = <
 			AM64X_IOPAD(0x0034, PIN_OUTPUT, 7)	/* Pad OSPI0_CSn2 Mux GPIO0_13 */
 			AM64X_IOPAD(0x0038, PIN_INPUT, 7)	/* Pad OSPI0_CSn3 Mux GPIO0_14 */
 		>;
 	};
+
+	regulator_vpp_1v8_pins_default: regulator-vpp-1v8-pins-default {
+		u-boot,dm-spl;
+		pinctrl-single,pins = <
+			AM64X_IOPAD(0x029c, PIN_OUTPUT, 7)	/* Pad MMC1_SDWP Mux GPIO1_78 */
+		>;
+	};
 };
 
 /* Console */
-- 
2.35.3

